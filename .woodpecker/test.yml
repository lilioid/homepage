steps:
  - name: check-pre-commit
    depends_on: []
    when:
      - event: push
      - event: cron
      - event: manual
    image: docker.io/nixos/nix
    volumes:
      - woodpecker-cache:/woodpecker/cache
    backend_options:
      kubernetes:
        resources:
          requests:
            memory: 2Gi
            cpu: 500m
          limits:
            memory: 2Gi
    environment:
      XDG_CACHE_HOME: /woodpecker/cache
    commands:
      - . <(nix --extra-experimental-features "nix-command flakes" --store /woodpecker/cache/nix-store print-dev-env .)
      - pre-commit run --show-diff-on-failure --all-files
